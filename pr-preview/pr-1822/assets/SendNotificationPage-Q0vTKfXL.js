import{dP as te,dQ as ne,b1 as a,b2 as l,bq as f,dR as re,dS as le,bi as z,cG as ce,a_ as I,aY as O,cC as de,b$ as k,cI as oe,cJ as ue,dT as S,bp as y,dU as _,dV as j,d9 as he,dW as pe,dK as ge,bY as xe,dX as me,dw as fe,dY as be,aZ as ye,dZ as Ce,d_ as ve,d$ as je,__tla as ke}from"./index-Uf65UhbI.js";import{c as Se,a as p,u as Te,__tla as Ie}from"./index.esm-A0MRAFhY.js";import{g as _e,__tla as Ue}from"./Common.utils-DY4Lm_bZ.js";import{u as we,__tla as Ae}from"./useMutation-D1KuCrz_.js";import{g}from"./Common.form-LPxQflxb.js";import{C as De,__tla as Le}from"./ContentLayout-uEeJnWfc.js";let W,Re=Promise.all([(()=>{try{return ke}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return Ue}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return Le}catch{}})()]).then(async()=>{let U,w,A,D,L,R,M,E,V,N,F,B,P,K;U=i=>i,w=({userPushSDKInstance:i,channel:s,recipients:n,payload:r,notification:c})=>i.channel.send(n,{notification:c,payload:r,channel:s}).then(U),A=()=>we({mutationKey:[te],mutationFn:w}),D=i=>{const s=ne(),n=({title:r,body:c,cta:o,channelName:m,icon:u,image:C,chainId:d})=>a.jsx(re,{notificationTitle:r,notificationBody:c,cta:o,app:m,icon:u,image:C,chainName:le[d],theme:s.mode,url:""});return a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-none",children:[a.jsx(f,{variant:"h6-semibold",color:"text-primary",textTransform:"uppercase",children:"Preview Notification"}),a.jsx(n,{...i})]})},L=i=>{var s,n;return[...((n=(s=i==null?void 0:i.aliases)==null?void 0:s.filter(r=>r.is_alias_verified))==null?void 0:n.map(r=>parseInt(r.alias_blockchain_id)))||[],z.coreContractChain]},R=i=>i&&i.length?i==null?void 0:i.map(s=>({icon:a.jsx(l,{width:"24px",height:"24px",borderRadius:"radius-xxs",overflow:"hidden",children:a.jsx("img",{width:"100%",height:"100%",src:s==null?void 0:s.iconV2,alt:s==null?void 0:s.name})}),label:s==null?void 0:s.name,value:s==null?void 0:s.channel})):[],M=i=>{var r;let s=[];const n={label:"Default",value:"0"};return i&&(s=((r=JSON.parse(i==null?void 0:i.channel_settings))==null?void 0:r.map((c,o)=>({label:c==null?void 0:c.description,value:(o+1).toString()})))||[]),[...s,n]},E=(i,s)=>{if(s){if(i==="SUBSET")return s.split(",");if(i==="TARGETTED")return[s]}return["*"]},V=(i,s,n)=>{var r;return console.debug(i),n?ce(i.channel,parseInt(s)):((r=i.aliases.find(c=>c.alias_blockchain_id===s))==null?void 0:r.alias_address)||i.channel},N=[{label:"Broadcast",value:"BROADCAST"},{label:"Targeted",value:"TARGETTED"},{label:"Subset",value:"SUBSET"}],F=i=>Se().shape({channelAddress:p().required(g("Delegate")),chainId:p().required(g("Chain")),type:p().required(g("Type")),body:p().required(g("Description")),setting:p().required(g("Setting")),recipient:p().test("recipient",g("Recipient"),function(s){return(this.parent.type!=="SUBSET"||i)&&(this.parent.type!=="TARGETTED"||!!s)}),title:p().test("title",g("Title"),function(s){return!this.parent.titleChecked||!!s}),mediaUrl:p().test("mediaUrl",g("Media URL"),function(s){return!this.parent.mediaUrlChecked||!!s}),ctaLink:p().test("ctaLink",g("CTA Link"),function(s){return!this.parent.ctaLinkChecked||!!s})}),B=i=>{var s;return{channelAddress:((s=i[0])==null?void 0:s.value)||"",chainId:z.coreContractChain.toString(),type:"BROADCAST",recipient:"",titleChecked:!1,mediaUrlChecked:!1,ctaLinkChecked:!1,title:"",body:"",setting:"0",mediaUrl:"",ctaLink:""}},P=({channelDetails:i})=>{const[s,n]=I.useState([]),{chainId:r,switchChain:c}=O(),{mutate:o,isPending:m}=A(),u=de(),{userPushSDKInstance:C}=k(t=>t.user),{delegatees:d}=k(t=>t.admin),Y=me===r,q=R(d!=null&&d.length?d:i?[i]:[]),e=Te({initialValues:B(q),validationSchema:F(!!s.length),onSubmit:t=>{$(t)}}),h=(d==null?void 0:d.find(t=>t.channel===e.values.channelAddress))||i,J=_e(L(h)),Z=e.values.body||e.values.title||e.values.ctaLink||e.values.mediaUrl,$=({chainId:t,title:x,type:b,recipient:v,ctaLink:ee,mediaUrl:ae,body:G,setting:se})=>{o({channel:V(h,t,Y),recipients:E(b,v||s.join()),notification:{title:x,body:G},userPushSDKInstance:C,payload:{title:x,body:G,cta:ee,embed:ae,category:parseInt(se)??void 0}},{onSuccess:()=>{u.showMessageToast({toastTitle:"Success",toastMessage:"Successfully sent notification",toastType:"SUCCESS",getToastIcon:T=>a.jsx(oe,{size:T,color:"green"})}),e.resetForm()},onError:T=>{T&&u.showMessageToast({toastTitle:"Error",toastMessage:"Unable to send notification",toastType:"ERROR",getToastIcon:ie=>a.jsx(ue,{size:ie,color:"red"})})}})},Q=t=>{if(t.key==="Enter"&&t.preventDefault(),["Enter",","].includes(t.key)){const x=e.values.recipient.split(" ").filter(b=>b);n(b=>{const v=new Set([...b,...x]);return Array.from(v)}),e.setFieldValue("recipient","")}},X=t=>{n(x=>x.filter((b,v)=>v!==t))},H=t=>{e.setFieldValue("type",t),e.setFieldValue("recipient",""),n([])};return a.jsx("form",{onSubmit:e.handleSubmit,children:a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xl",alignItems:"center",children:[a.jsxs(l,{display:"flex",gap:{dp:"spacing-md",ml:"spacing-sm"},width:"100%",flexDirection:"column",children:[a.jsxs(l,{display:"flex",gap:"spacing-sm",flexDirection:{dp:"row",ml:"column"},children:[a.jsx(l,{width:{dp:"65%",ml:"auto"},children:a.jsx(S,{options:q,value:e.values.channelAddress,onSelect:e.handleChange("channelAddress"),error:e.touched.channelAddress&&!!e.errors.channelAddress,errorMessage:e.touched.channelAddress?e.errors.channelAddress:""})}),a.jsx(S,{options:J,value:e.values.chainId,onSelect:t=>{e.setFieldValue("chainId",t),c(parseInt(t))},error:e.touched.chainId&&!!e.errors.chainId,errorMessage:e.touched.chainId?e.errors.chainId:""})]}),a.jsx(S,{options:N,value:e.values.type,onSelect:t=>H(t),error:e.touched.type&&!!e.errors.type,errorMessage:e.touched.type?e.errors.type:""}),a.jsxs(l,{display:"flex",gap:"spacing-sm",justifyContent:"space-between",css:y`
              flex-wrap: wrap;
            `,children:[a.jsxs(l,{css:y`
                flex: 1;
              `,display:"flex",alignItems:"center",backgroundColor:"surface-secondary",borderRadius:"radius-xs",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(f,{ellipsis:!0,variant:"bs-semibold",children:"Title"}),a.jsx(_,{leadingToggle:!1,checked:e.values.titleChecked,onCheckedChange:t=>e.setFieldValue("titleChecked",t)})]}),a.jsxs(l,{css:y`
                flex: 1;
              `,display:"flex",backgroundColor:"surface-secondary",borderRadius:"radius-xs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(f,{ellipsis:!0,variant:"bs-semibold",children:"Media URL"}),a.jsx(_,{leadingToggle:!1,checked:e.values.mediaUrlChecked,onCheckedChange:t=>e.setFieldValue("mediaUrlChecked",t)})]}),a.jsxs(l,{css:y`
                flex: 1;
              `,display:"flex",backgroundColor:"surface-secondary",borderRadius:"radius-xs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(f,{ellipsis:!0,variant:"bs-semibold",children:"CTA Link"}),a.jsx(_,{leadingToggle:!1,checked:e.values.ctaLinkChecked,onCheckedChange:t=>e.setFieldValue("ctaLinkChecked",t)})]})]}),e.values.type==="TARGETTED"&&a.jsx(j,{placeholder:"Input Value",label:"Recipient Wallet Address",onChange:e.handleChange("recipient"),value:e.values.recipient,error:e.touched.recipient&&!!e.errors.recipient,errorMessage:e.touched.recipient?e.errors.recipient:""}),e.values.type==="SUBSET"&&a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xs",onKeyDown:t=>Q(t),children:[a.jsx(l,{display:"flex",gap:"spacing-xxs",css:y`
                  flex-wrap: wrap;
                `,children:!!s.length&&s.map((t,x)=>a.jsxs(l,{display:"flex",gap:"spacing-xxs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xxxs spacing-xxs",borderRadius:"radius-xxxs",backgroundColor:"surface-brand-medium",children:[a.jsx(f,{color:"text-brand-subtle",children:t.slice(0,-1)}),a.jsx(l,{cursor:"pointer",display:"flex",alignItems:"center",onClick:()=>X(x),children:a.jsx(he,{size:14,color:"icon-secondary"})})]}))}),a.jsx(j,{placeholder:"Input Value",label:"Enter Recipients Wallet Addresses",description:"Enter recipients wallet addresses separated by a comma or by pressing the enter key",onChange:t=>e.setFieldValue("recipient",t.target.value),value:e.values.recipient,error:e.touched.recipient&&!!e.errors.recipient,errorMessage:e.touched.recipient?e.errors.recipient:""})]}),e.values.titleChecked&&a.jsx(j,{totalCount:80,placeholder:"Input Value",label:"Notification Title",onChange:e.handleChange("title"),value:e.values.title,error:e.touched.title&&!!e.errors.title,errorMessage:e.touched.title?e.errors.title:""}),a.jsx(pe,{label:"Notification Message",placeholder:"Input Value",totalCount:500,onChange:e.handleChange("body"),value:e.values.body,error:e.touched.body&&!!e.errors.body,errorMessage:e.touched.body?e.errors.body:""}),a.jsx(S,{action:a.jsx(ge,{textProps:{color:"text-brand-medium"},to:"/channel/settings",children:"Manage Setting"}),label:"Notification Setting Type",options:M(h),value:e.values.setting,onSelect:e.handleChange("setting"),error:e.touched.setting&&!!e.errors.setting,errorMessage:e.touched.setting?e.errors.setting:""}),e.values.mediaUrlChecked&&a.jsx(j,{placeholder:"Input Value",label:"Media URL",onChange:e.handleChange("mediaUrl"),value:e.values.mediaUrl,error:e.touched.mediaUrl&&!!e.errors.mediaUrl,errorMessage:e.touched.mediaUrl?e.errors.mediaUrl:""}),e.values.ctaLinkChecked&&a.jsx(j,{placeholder:"Input Value",label:"CTA Link",onChange:e.handleChange("ctaLink"),value:e.values.ctaLink,error:e.touched.ctaLink&&!!e.errors.ctaLink,errorMessage:e.touched.ctaLink?e.errors.ctaLink:""}),Z&&a.jsx(D,{title:e.values.title,body:e.values.body,cta:e.values.ctaLink,channelName:(h==null?void 0:h.name)||"",icon:(h==null?void 0:h.iconV2)||"",image:e.values.mediaUrl,chainId:parseInt(e.values.chainId)})]}),a.jsx(xe,{disabled:m,children:m?"Sending":" Send Notification"})]})})},K=()=>{const[i,s]=I.useState(!0),{userPushSDKInstance:n}=k(d=>d.user),{account:r,chainId:c}=O(),{data:o}=fe(r),{data:m}=be({alias:r,aliasChain:je[c]}),{delegatees:u}=k(d=>d.admin),C=ye();return console.debug(u,m,"delegtees"),I.useEffect(()=>{!o&&!(u!=null&&u.length)&&!m&&C("/channels")},[o]),a.jsxs(l,{padding:{dp:"spacing-lg",ml:"spacing-sm"},display:"flex",flexDirection:"column",gap:{dp:"spacing-xl",ml:"spacing-md"},alignSelf:"center",width:{dp:"648px",ml:"357px"},borderRadius:"radius-lg",alignItems:"center",backgroundColor:"surface-primary",margin:{dp:"spacing-lg",ml:"spacing-sm"},children:[a.jsx(f,{color:"text-primary",variant:"h3-semibold",display:{dp:"block",ml:"none"},children:"Send Notification"}),a.jsx(f,{color:"text-primary",variant:"h5-semibold",display:{dp:"none",ml:"block"},children:"Send Notification"}),a.jsx(l,{width:"100%",children:a.jsx(P,{channelDetails:o})}),i&&n&&(n==null?void 0:n.readmode())&&a.jsx(l,{display:"flex",justifyContent:"center",width:"-webkit-fill-available",alignItems:"center",css:y`
            z-index: 99999;
          `,children:a.jsx(Ce,{type:ve.MODAL,showConnectModal:!0,onClose:()=>s(!1),description:"Unlock your profile to proceed."})})]})},W=()=>a.jsx(De,{children:a.jsx(K,{})})});export{Re as __tla,W as default};
