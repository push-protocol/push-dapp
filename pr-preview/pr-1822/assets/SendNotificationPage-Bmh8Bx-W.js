import{dP as ne,dQ as re,b1 as a,b2 as l,bq as b,dR as le,dS as ce,dT as de,bi as Y,cG as oe,a_ as _,aY as J,cC as ue,b$ as S,cI as he,cJ as pe,dU as I,bp as v,dV as w,dW as k,d9 as ge,dX as xe,dK as me,bY as fe,dY as be,dZ as ye,dw as Ce,aZ as ve,d_ as je,d$ as ke,e0 as Se,__tla as Ie}from"./index-B2b9jQwN.js";import{c as Te,a as h,u as _e,__tla as we}from"./index.esm-CxG-FGuL.js";import{g as Ue,__tla as Ae}from"./Common.utils-BQtC5U0C.js";import{u as De,__tla as Le}from"./useMutation-DSQgU0dt.js";import{g as p}from"./Common.form-LPxQflxb.js";import{C as Re,__tla as Ee}from"./ContentLayout-DvQKgfWM.js";let Z,Me=Promise.all([(()=>{try{return Ie}catch{}})(),(()=>{try{return we}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return Le}catch{}})(),(()=>{try{return Ee}catch{}})()]).then(async()=>{let U,A,D,L,R,E,M,V,N,F,B,P,K,q;U=t=>t,A=({userPushSDKInstance:t,channel:s,recipients:n,payload:r,notification:c})=>t.channel.send(n,{notification:c,payload:r,channel:s}).then(U),D=()=>De({mutationKey:[ne],mutationFn:A}),L=t=>{const s=re(),n=({title:r,body:c,cta:d,channelName:o,icon:g,image:y,chainId:m})=>a.jsx(le,{notificationTitle:r,notificationBody:c,cta:d,app:o,icon:g,image:y,chainName:ce[m],theme:s.mode,url:""});return a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-none",children:[a.jsx(b,{variant:"h6-semibold",color:"text-primary",textTransform:"uppercase",children:"Preview Notification"}),a.jsx(n,{...t})]})},R=(t,s,n)=>{var c,d;const r=((d=(c=t==null?void 0:t.aliases)==null?void 0:c.filter(o=>o.is_alias_verified&&de(o.alias_address)===s))==null?void 0:d.map(o=>parseInt(o.alias_blockchain_id)))||[];return n?[...r,Y.coreContractChain]:r},E=t=>t&&t.length?t==null?void 0:t.map(s=>({icon:a.jsx(l,{width:"24px",height:"24px",borderRadius:"radius-xxs",overflow:"hidden",children:a.jsx("img",{width:"100%",height:"100%",src:s==null?void 0:s.iconV2,alt:s==null?void 0:s.name})}),label:s==null?void 0:s.name,value:s==null?void 0:s.channel})):[],M=t=>{var r;let s=[];const n={label:"Default",value:"0"};return t&&(s=((r=JSON.parse(t==null?void 0:t.channel_settings))==null?void 0:r.map((c,d)=>({label:c==null?void 0:c.description,value:(d+1).toString()})))||[]),[...s,n]},V=(t,s)=>{if(s){if(t==="SUBSET")return s.split(",");if(t==="TARGETTED")return[s]}return["*"]},N=(t,s,n)=>{var r;return console.debug(t),n?oe(t.channel,parseInt(s)):((r=t.aliases.find(c=>c.alias_blockchain_id===s))==null?void 0:r.alias_address)||t.channel},F=[{label:"Broadcast",value:"BROADCAST"},{label:"Targeted",value:"TARGETTED"},{label:"Subset",value:"SUBSET"}],B=t=>Te().shape({channelAddress:h().required(p("Delegate")),chainId:h().required(p("Chain")),type:h().required(p("Type")),body:h().required(p("Description")),setting:h().required(p("Setting")),recipient:h().test("recipient",p("Recipient"),function(s){return(this.parent.type!=="SUBSET"||t)&&(this.parent.type!=="TARGETTED"||!!s)}),title:h().test("title",p("Title"),function(s){return!this.parent.titleChecked||!!s}),mediaUrl:h().test("mediaUrl",p("Media URL"),function(s){return!this.parent.mediaUrlChecked||!!s}),ctaLink:h().test("ctaLink",p("CTA Link"),function(s){return!this.parent.ctaLinkChecked||!!s})}),P=(t,s)=>{var n,r;return{channelAddress:((n=t[0])==null?void 0:n.value)||"",chainId:((r=s[0])==null?void 0:r.value)||Y.coreContractChain.toString(),type:"BROADCAST",recipient:"",titleChecked:!1,mediaUrlChecked:!1,ctaLinkChecked:!1,title:"",body:"",setting:"0",mediaUrl:"",ctaLink:""}},K=({channelDetails:t})=>{const[s,n]=_.useState([]),{chainId:r,switchChain:c,account:d}=J(),{mutate:o,isPending:g}=D(),y=ue(),{userPushSDKInstance:m}=S(i=>i.user),{delegatees:f}=S(i=>i.admin),G=be===r,O=E(f!=null&&f.length?f:t?[t]:[]),u=(f==null?void 0:f.find(i=>i.channel===e.values.channelAddress))||t,z=Ue(R(u,d,G)),e=_e({initialValues:P(O,z),validationSchema:B(!!s.length),onSubmit:i=>{Q(i)}}),$=e.values.body||e.values.title||e.values.ctaLink||e.values.mediaUrl,Q=({chainId:i,title:x,type:C,recipient:j,ctaLink:ae,mediaUrl:se,body:W,setting:te})=>{o({channel:N(u,i,G),recipients:V(C,j||s.join()),notification:{title:x,body:W},userPushSDKInstance:m,payload:{title:x,body:W,cta:ae,embed:se,category:parseInt(te)??void 0}},{onSuccess:()=>{y.showMessageToast({toastTitle:"Success",toastMessage:"Successfully sent notification",toastType:"SUCCESS",getToastIcon:T=>a.jsx(he,{size:T,color:"green"})}),e.resetForm()},onError:T=>{T&&y.showMessageToast({toastTitle:"Error",toastMessage:"Unable to send notification",toastType:"ERROR",getToastIcon:ie=>a.jsx(pe,{size:ie,color:"red"})})}})},X=i=>{if(i.key==="Enter"&&i.preventDefault(),["Enter",","].includes(i.key)){const x=e.values.recipient.split(" ").filter(C=>C);n(C=>{const j=new Set([...C,...x]);return Array.from(j)}),e.setFieldValue("recipient","")}},H=i=>{n(x=>x.filter((C,j)=>j!==i))},ee=i=>{e.setFieldValue("type",i),e.setFieldValue("recipient",""),n([])};return a.jsx("form",{onSubmit:e.handleSubmit,children:a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xl",alignItems:"center",children:[a.jsxs(l,{display:"flex",gap:{dp:"spacing-md",ml:"spacing-sm"},width:"100%",flexDirection:"column",children:[a.jsxs(l,{display:"flex",gap:"spacing-sm",flexDirection:{dp:"row",ml:"column"},children:[a.jsx(l,{width:{dp:"65%",ml:"auto"},children:a.jsx(I,{options:O,value:e.values.channelAddress,onSelect:e.handleChange("channelAddress"),error:e.touched.channelAddress&&!!e.errors.channelAddress,errorMessage:e.touched.channelAddress?e.errors.channelAddress:""})}),a.jsx(I,{options:z,value:e.values.chainId,onSelect:i=>{e.setFieldValue("chainId",i),c(parseInt(i))},error:e.touched.chainId&&!!e.errors.chainId,errorMessage:e.touched.chainId?e.errors.chainId:""})]}),a.jsx(I,{options:F,value:e.values.type,onSelect:i=>ee(i),error:e.touched.type&&!!e.errors.type,errorMessage:e.touched.type?e.errors.type:""}),a.jsxs(l,{display:"flex",gap:"spacing-sm",justifyContent:"space-between",css:v`
              flex-wrap: wrap;
            `,children:[a.jsxs(l,{css:v`
                flex: 1;
              `,display:"flex",alignItems:"center",backgroundColor:"surface-secondary",borderRadius:"radius-xs",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(b,{ellipsis:!0,variant:"bs-semibold",children:"Title"}),a.jsx(w,{leadingToggle:!1,checked:e.values.titleChecked,onCheckedChange:i=>e.setFieldValue("titleChecked",i)})]}),a.jsxs(l,{css:v`
                flex: 1;
              `,display:"flex",backgroundColor:"surface-secondary",borderRadius:"radius-xs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(b,{ellipsis:!0,variant:"bs-semibold",children:"Media URL"}),a.jsx(w,{leadingToggle:!1,checked:e.values.mediaUrlChecked,onCheckedChange:i=>e.setFieldValue("mediaUrlChecked",i)})]}),a.jsxs(l,{css:v`
                flex: 1;
              `,display:"flex",backgroundColor:"surface-secondary",borderRadius:"radius-xs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xs",children:[a.jsx(b,{ellipsis:!0,variant:"bs-semibold",children:"CTA Link"}),a.jsx(w,{leadingToggle:!1,checked:e.values.ctaLinkChecked,onCheckedChange:i=>e.setFieldValue("ctaLinkChecked",i)})]})]}),e.values.type==="TARGETTED"&&a.jsx(k,{placeholder:"Input Value",label:"Recipient Wallet Address",onChange:e.handleChange("recipient"),value:e.values.recipient,error:e.touched.recipient&&!!e.errors.recipient,errorMessage:e.touched.recipient?e.errors.recipient:""}),e.values.type==="SUBSET"&&a.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xs",onKeyDown:i=>X(i),children:[a.jsx(l,{display:"flex",gap:"spacing-xxs",css:v`
                  flex-wrap: wrap;
                `,children:!!s.length&&s.map((i,x)=>a.jsxs(l,{display:"flex",gap:"spacing-xxs",alignItems:"center",justifyContent:"space-between",padding:"spacing-xxxs spacing-xxs",borderRadius:"radius-xxxs",backgroundColor:"surface-brand-medium",children:[a.jsx(b,{color:"text-brand-subtle",children:i.slice(0,-1)}),a.jsx(l,{cursor:"pointer",display:"flex",alignItems:"center",onClick:()=>H(x),children:a.jsx(ge,{size:14,color:"icon-secondary"})})]}))}),a.jsx(k,{placeholder:"Input Value",label:"Enter Recipients Wallet Addresses",description:"Enter recipients wallet addresses separated by a comma or by pressing the enter key",onChange:i=>e.setFieldValue("recipient",i.target.value),value:e.values.recipient,error:e.touched.recipient&&!!e.errors.recipient,errorMessage:e.touched.recipient?e.errors.recipient:""})]}),e.values.titleChecked&&a.jsx(k,{totalCount:80,placeholder:"Input Value",label:"Notification Title",onChange:e.handleChange("title"),value:e.values.title,error:e.touched.title&&!!e.errors.title,errorMessage:e.touched.title?e.errors.title:""}),a.jsx(xe,{label:"Notification Message",placeholder:"Input Value",totalCount:500,onChange:e.handleChange("body"),value:e.values.body,error:e.touched.body&&!!e.errors.body,errorMessage:e.touched.body?e.errors.body:""}),a.jsx(I,{action:a.jsx(me,{textProps:{color:"text-brand-medium"},to:"/channel/settings",children:"Manage Setting"}),label:"Notification Setting Type",options:M(u),value:e.values.setting,onSelect:e.handleChange("setting"),error:e.touched.setting&&!!e.errors.setting,errorMessage:e.touched.setting?e.errors.setting:""}),e.values.mediaUrlChecked&&a.jsx(k,{placeholder:"Input Value",label:"Media URL",onChange:e.handleChange("mediaUrl"),value:e.values.mediaUrl,error:e.touched.mediaUrl&&!!e.errors.mediaUrl,errorMessage:e.touched.mediaUrl?e.errors.mediaUrl:""}),e.values.ctaLinkChecked&&a.jsx(k,{placeholder:"Input Value",label:"CTA Link",onChange:e.handleChange("ctaLink"),value:e.values.ctaLink,error:e.touched.ctaLink&&!!e.errors.ctaLink,errorMessage:e.touched.ctaLink?e.errors.ctaLink:""}),$&&a.jsx(L,{title:e.values.title,body:e.values.body,cta:e.values.ctaLink,channelName:(u==null?void 0:u.name)||"",icon:(u==null?void 0:u.iconV2)||"",image:e.values.mediaUrl,chainId:parseInt(e.values.chainId)})]}),a.jsx(fe,{disabled:g,children:g?"Sending":" Send Notification"})]})})},q=()=>{const[t,s]=_.useState(!0),{userPushSDKInstance:n}=S(m=>m.user),{account:r,chainId:c}=J(),{data:d}=ye({alias:r,aliasChain:Se[c]}),{data:o}=Ce((d==null?void 0:d.channel)||r),{delegatees:g}=S(m=>m.admin),y=ve();return _.useEffect(()=>{!o&&!(g!=null&&g.length)&&!d&&y("/channels")},[o]),a.jsxs(l,{padding:{dp:"spacing-lg",ml:"spacing-sm"},display:"flex",flexDirection:"column",gap:{dp:"spacing-xl",ml:"spacing-md"},alignSelf:"center",width:{dp:"648px",ml:"357px"},borderRadius:"radius-lg",alignItems:"center",backgroundColor:"surface-primary",margin:{dp:"spacing-lg",ml:"spacing-sm"},children:[a.jsx(b,{color:"text-primary",variant:"h3-semibold",display:{dp:"block",ml:"none"},children:"Send Notification"}),a.jsx(b,{color:"text-primary",variant:"h5-semibold",display:{dp:"none",ml:"block"},children:"Send Notification"}),a.jsx(l,{width:"100%",children:a.jsx(K,{channelDetails:o})}),t&&n&&(n==null?void 0:n.readmode())&&a.jsx(l,{display:"flex",justifyContent:"center",width:"-webkit-fill-available",alignItems:"center",css:v`
            z-index: 99999;
          `,children:a.jsx(je,{type:ke.MODAL,showConnectModal:!0,onClose:()=>s(!1),description:"Unlock your profile to proceed."})})]})},Z=()=>a.jsx(Re,{children:a.jsx(q,{})})});export{Me as __tla,Z as default};
