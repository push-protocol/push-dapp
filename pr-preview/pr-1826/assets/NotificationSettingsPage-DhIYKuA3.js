import{e1 as e,er as le,d_ as f,hF as pe,dY as I,e2 as a,eq as b,eY as M,g9 as me,hG as se,hH as he,hI as xe,hJ as oe,hK as fe,dZ as ue,e$ as be,hL as je,d$ as we,hl as Ce,e0 as H,ek as Se,en as ye,h0 as N,fG as ve,fH as Ne,ep as _e,g$ as de,hM as Ve,gB as Me,__tla as ke}from"./index-51LRe8QW.js";import{C as Re,__tla as Ee}from"./ContentLayout-0SgDVoJA.js";import{A as De,O as Le,__tla as Ie}from"./OptOut-BqGpQF5K.js";import{C as Pe,__tla as Te}from"./ChannelDashboardNullState-CWBGclY_.js";import{u as Ae,S as Fe,__tla as qe}from"./StakingVariant-BEcoQmIa.js";import{u as He,__tla as $e}from"./useMutation-d6JsUhKF.js";import{a as Oe,__tla as ze}from"./PushTokenContractHelper-CCbYwSYB.js";import{C as Be,__tla as Ke}from"./Checkbox-N_e0CQum.js";import{c as Ue,a as Ze,d as $,e as c,f as ge,u as We,F as Je,b as Ge,__tla as Ye}from"./index.esm-CSzE0WNo.js";import{g as v,a as k,b as O}from"./Common.form-iMV6nXze.js";let ce,Qe=Promise.all([(()=>{try{return ke}catch{}})(),(()=>{try{return Ee}catch{}})(),(()=>{try{return Ie}catch{}})(),(()=>{try{return Te}catch{}})(),(()=>{try{return qe}catch{}})(),(()=>{try{return $e}catch{}})(),(()=>{try{return ze}catch{}})(),(()=>{try{return Ke}catch{}})(),(()=>{try{return Ye}catch{}})()]).then(async()=>{let z,B,K,U,Z,P,W,J,G,D,Y,Q,X,ee,T,te,ie,ne,re,ae;z=t=>{const{svgProps:i,...r}=t;return e.jsx(le,{componentName:"KebabMenuVertical",icon:e.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i,children:[e.jsxs("g",{"clip-path":"url(#clip0_372_37265)",children:[e.jsx("path",{d:"M16 9.00001C17.3807 9.00001 18.5 7.88072 18.5 6.5C18.5 5.11929 17.3807 4 16 4C14.6193 4 13.5 5.11929 13.5 6.5C13.5 7.88072 14.6193 9.00001 16 9.00001Z",fill:"currentColor"}),e.jsx("path",{d:"M16 18.5C17.3807 18.5 18.5 17.3807 18.5 16C18.5 14.6193 17.3807 13.5 16 13.5C14.6193 13.5 13.5 14.6193 13.5 16C13.5 17.3807 14.6193 18.5 16 18.5Z",fill:"currentColor"}),e.jsx("path",{d:"M16 28C17.3807 28 18.5 26.8807 18.5 25.5C18.5 24.1193 17.3807 23 16 23C14.6193 23 13.5 24.1193 13.5 25.5C13.5 26.8807 14.6193 28 16 28Z",fill:"currentColor"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_372_37265",children:e.jsx("rect",{width:"32",height:"32",fill:"white"})})})]}),...r})},B=t=>{const{svgProps:i,...r}=t;return e.jsx(le,{componentName:"Pencil",icon:e.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i,children:[e.jsx("path",{d:"M8.47489 20.25H4.46739C4.27712 20.25 4.09465 20.1744 3.96012 20.0399C3.82558 19.9053 3.75 19.7229 3.75 19.5326V15.5251C3.75009 15.3351 3.82555 15.1529 3.95984 15.0185L15.0183 3.95995C15.1529 3.82552 15.3353 3.75 15.5254 3.75C15.7156 3.75 15.898 3.82552 16.0325 3.95995L20.04 7.96476C20.1745 8.09928 20.25 8.28168 20.25 8.47186C20.25 8.66204 20.1745 8.84444 20.04 8.97896L8.98154 20.0402C8.84711 20.1744 8.66489 20.2499 8.47489 20.25Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M12.3589 6.61963L17.3806 11.6413",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})]}),...r})},K=()=>{const[t,i]=f.useState(!1),r=f.useCallback(()=>i(!0),[]),n=f.useCallback(()=>i(!1),[]);return{isOpen:t,onClose:n,open:r}},U=async({userPushSDKInstance:t,settings:i})=>await t.channel.setting(i),Z=()=>He({mutationKey:[pe],mutationFn:U}),P={type:1,default:0,description:"",index:0},W=({modalControl:t,setSettingsToEdit:i})=>{const{open:r}=t,{isWalletConnected:n,connect:l}=I(),u=()=>n?r():l();return e.jsxs(a,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",width:"100%",children:[e.jsxs(a,{children:[e.jsx(b,{variant:"h4-semibold",color:"text-primary",children:"Notification Settings"}),e.jsx(b,{variant:"bs-regular",color:"text-tertiary",children:"Add, Edit or Remove Notification Settings"})]}),e.jsx(M,{size:"extraSmall",variant:"tertiary",leadingIcon:e.jsx(De,{}),onClick:()=>{i(P),u()},children:"Add Setting"})]})},J=({setting:t,modalControl:i,loadingSettings:r,setSettingsToEdit:n,handleDeleteSetting:l})=>{const{open:u}=i;return e.jsxs(a,{display:"flex",width:"100%",padding:"spacing-sm spacing-none",justifyContent:"space-between",children:[e.jsx(me,{isLoading:r,height:"20px",width:"100px",children:e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%",gap:"spacing-xxs",children:[e.jsx(b,{variant:"bs-regular",color:"text-primary",children:t.description}),t.type==2&&e.jsx(se,{children:"Range"}),t.type==3&&e.jsx(se,{children:"Multi-Range"})]})}),e.jsx(he,{overlay:e.jsxs(xe,{children:[e.jsx(oe,{label:"Edit",icon:e.jsx(B,{size:24}),onClick:()=>{n(t),u()}}),e.jsx(oe,{label:"Remove",icon:e.jsx(Le,{size:24}),onClick:()=>{l(t)}})]}),children:e.jsx(a,{cursor:"pointer",children:e.jsx(z,{})})})]})},G=({newSettings:t,loadingSettings:i,modalControl:r,setSettingsToEdit:n,handleDeleteSetting:l,handleSettingsChange:u})=>e.jsx(a,{width:"100%",display:"flex",flexDirection:"column",children:t.map((s,d)=>e.jsxs(a,{children:[e.jsx(J,{loadingSettings:i,setting:s,modalControl:r,setSettingsToEdit:n,handleDeleteSetting:l,handleSettingsChange:u}),e.jsx(fe,{})]},d))}),D=50,Y=({newSettings:t,channelSettings:i})=>{const r=ue(),{account:n,provider:l,wallet:u,isWalletConnected:s,connect:d}=I(),{userPushSDKInstance:p}=be(h=>h.user),{handleConnectWalletAndEnableProfile:_}=je(),{refetchChannelDetails:R}=we(),[S,o]=f.useState(0),[m,j]=f.useState(""),w=async()=>{const h=await Oe({address:n,provider:l,contractAddress:Se.epnscore});o(parseInt(h))};f.useEffect(()=>{!n||!l||w()},[n,l]);const{mutate:V,isPending:y}=Ae(),L=async()=>{if(!l)return;if(!s){d();return}j("");const h=l.getSigner(n),x=ye((D-S).toString(),18);V({noOfTokenToApprove:x,signer:h},{onSuccess:()=>{w()},onError:g=>{console.log("Error in Approving PUSH",g),g.code=="ACTION_REJECTED"?j("User rejected signature. Please try again."):j("Error in approving PUSH Tokens")}})},{mutate:A,isPending:E}=Z(),F=async()=>{let h=p;if(!(!h.signer&&(h=await _({wallet:u}),!h))&&(j(""),t.length)){const x=t.map(g=>g.type===1?{type:g.type,description:g.description,default:g.default?1:0}:{type:g.type,description:g.description,default:g.default,data:{lower:g.lowerLimit,upper:g.upperLimit,ticker:g.ticker,enabled:g.enabled}});A({userPushSDKInstance:h,settings:x},{onSuccess:g=>{g.transactionHash&&(R(),r(`${H.ChannelDashboard}/${n}`))},onError:g=>{console.log("Error in adding setting",g),j("Error in saving settings. Please try again later")}})}},q=f.useMemo(()=>{if(!i)return!1;if(t.length!==i.length)return!0;let h=!1;return t.forEach((x,g)=>{const C=i[g];if(x.type!==C.type){h=!0;return}if(x.type===1&&(x.description!==C.description||x.default!==C.default)){h=!0;return}if(x.type===2&&(x.description!==C.description||x.default!==C.default||x.enabled!==C.enabled||x.lowerLimit!==C.lowerLimit||x.upperLimit!==C.upperLimit||x.ticker!==C.ticker)){h=!0;return}}),h},[t,i]);return e.jsxs(a,{width:"100%",gap:"spacing-md",display:"flex",flexDirection:"column",children:[m&&e.jsx(Ce,{heading:m,variant:"error"}),e.jsx(Fe,{title:"Modify Setting Fee",description:"Make sure all settings are ready before proceeding to the next step",fees:D}),e.jsxs(a,{display:"flex",justifyContent:{initial:"end",ml:"center"},gap:"spacing-xs",children:[e.jsx(M,{variant:"outline",onClick:()=>r(`${H.ChannelDashboard}/${n}`),children:"Cancel"}),S>=D?e.jsx(M,{onClick:F,disabled:E||!q,loading:E,children:E?"Saving":"Save Settings"}):e.jsx(M,{onClick:L,disabled:y,loading:y,children:y?"Approving":"Approve PUSH"})]})]})},Q=t=>({settingName:t.description,isDefault:t.type===1?typeof t.default=="boolean"?t.default:!0:t.enabled,enableRange:t.type!==1,rangelowerlimit:t.lowerLimit?t.lowerLimit:0,rangeupperlimit:t.upperLimit?t.upperLimit:0,enableMultiRange:t.type===3,defaultValue:typeof t.default=="number"?t.default:0,multirangelowerlimit:typeof t.default=="object"?t.default.lower:0,multirangeupperlimit:typeof t.default=="object"?t.default.upper:0,sliderStepValue:t.ticker?t.ticker:0}),X=Ue().shape({settingName:Ze().required(v("Setting Name")),isDefault:$(),enableRange:$(),rangelowerlimit:c().when("enableRange",{is:!0,then:()=>c().min(1,k(1)).required(v("Range")),otherwise:()=>c()}),rangeupperlimit:c().when("enableRange",{is:!0,then:()=>c().min(ge("rangelowerlimit"),k("Lower limit")).required(v("Range")),otherwise:()=>c()}),enableMultiRange:$().required(v("")),multirangelowerlimit:c().when("enableMultiRange",{is:!0,then:()=>c().min(1,k(1)).required(v("Range")).test("is-multi-range-within-range",O("Multi-range lower limit"),(t,i)=>{const{rangelowerlimit:r,rangeupperlimit:n}=i.parent;return t>=r&&t<n}),otherwise:()=>c()}),multirangeupperlimit:c().when("enableMultiRange",{is:!0,then:()=>c().min(ge("multirangelowerlimit"),k("Lower limit")).required(v("Range")).test("is-multi-range-upper-within-range",O("Multi-range upper limit"),(t,i)=>{const{rangelowerlimit:r,rangeupperlimit:n}=i.parent;return t>r&&t<=n}),otherwise:()=>c()}),defaultValue:c().when("enableMultiRange",{is:!1,then:()=>c().min(0,k(0)).required(v("Default Value")).test("is-within-range",O("Default value"),(t,i)=>{const{rangelowerlimit:r,rangeupperlimit:n}=i.parent;return t>=r&&t<=n}),otherwise:()=>c()}),sliderStepValue:c().when("enableRange",{is:!0,then:()=>c().min(1,k(1)).required(v("Slider Step")).test("is-step-value-valid","Slider step value must not exceed the range limits.",(t,i)=>{const{rangeupperlimit:r}=i.parent;return t<r}),otherwise:()=>c()})}),ee=({children:t,initialValue:i,onSubmit:r})=>{const n=We({initialValues:Q(i),validationSchema:X,onSubmit:r});return e.jsx(Je,{value:n,children:t})},T=()=>{const t=Ge();if(!t)throw new Error("useEditNotificationSettingsForm must be used within a EditNotificationSettingsFormProvider");return t},te=()=>{const{values:t,handleChange:i,setFieldValue:r,errors:n,touched:l}=T(),u=f.useMemo(()=>{const{rangelowerlimit:o,rangeupperlimit:m,enableMultiRange:j,multirangelowerlimit:w,multirangeupperlimit:V,defaultValue:y,sliderStepValue:L}=t,A=Number(o)>0&&Number(m)>0,E=Number(L)>0&&Number(L)<=Number(m)-Number(o),F=!j&&Number(y)>=Number(o)&&Number(y)<=Number(m),q=j&&Number(w)>=Number(o)&&Number(V)<=Number(m)&&Number(V)>Number(w);return A&&E&&(q||F)},[t]),[s,d]=f.useState(t.defaultValue),[p,_]=f.useState(t.multirangelowerlimit),[R,S]=f.useState(t.multirangeupperlimit);return e.jsxs(e.Fragment,{children:[e.jsxs(a,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[e.jsx(b,{variant:"h6-bold",children:"Range Values"}),e.jsxs(a,{display:"flex",gap:"spacing-xxs",width:"100%",alignItems:"baseline",children:[e.jsx(N,{placeholder:"e.g.0",type:"number",value:t.rangelowerlimit,onChange:i("rangelowerlimit"),error:l.rangelowerlimit&&!!n.rangelowerlimit,errorMessage:l.rangelowerlimit?n.rangelowerlimit:""}),e.jsx(b,{variant:"bm-regular",children:"to"}),e.jsx(N,{placeholder:"e.g.10",type:"number",value:t.rangeupperlimit,onChange:o=>{r("rangeupperlimit",o.target.value)},error:l.rangeupperlimit&&!!n.rangeupperlimit,errorMessage:l.rangeupperlimit?n.rangeupperlimit:""})]})]}),e.jsxs(a,{display:"flex",gap:"spacing-xxs",children:[e.jsx(Be,{checked:t.enableMultiRange,onChange:()=>r("enableMultiRange",!t.enableMultiRange)}),e.jsxs(a,{children:[e.jsx(b,{ellipsis:!0,variant:"h6-bold",children:"Enable Multi Range"}),e.jsx(b,{variant:"bes-regular",children:"User can select a range of values in the slider"})]})]}),!t.enableMultiRange&&e.jsx(N,{placeholder:"e.g.0",type:"number",value:t.defaultValue,onChange:o=>{d(Number(o.target.value)),r("defaultValue",o.target.value)},label:"Default Value",error:l.defaultValue&&!!n.defaultValue,errorMessage:l.defaultValue?n.defaultValue:""}),t.enableMultiRange&&e.jsxs(a,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[e.jsx(b,{variant:"h6-bold",children:"Range Values"}),e.jsxs(a,{display:"flex",gap:"spacing-xxs",width:"100%",alignItems:"baseline",children:[e.jsx(N,{placeholder:"e.g.0",type:"number",value:t.multirangelowerlimit,onChange:o=>{r("multirangelowerlimit",o.target.value),_(Number(o.target.value))},error:l.multirangelowerlimit&&!!n.multirangelowerlimit,errorMessage:l.multirangelowerlimit?n.multirangelowerlimit:""}),e.jsx(b,{variant:"bm-regular",children:"to"}),e.jsx(N,{placeholder:"e.g.10",type:"number",value:t.multirangeupperlimit,onChange:o=>{r("multirangeupperlimit",o.target.value),S(Number(o.target.value))},error:l.multirangeupperlimit&&!!n.multirangeupperlimit,errorMessage:l.multirangeupperlimit?n.multirangeupperlimit:""})]})]}),e.jsx(a,{children:e.jsx(N,{placeholder:"e.g.0",type:"number",value:t.sliderStepValue,onChange:i("sliderStepValue"),label:"Slider Step Value",error:l.sliderStepValue&&!!n.sliderStepValue,errorMessage:l.sliderStepValue?n.sliderStepValue:""})}),u&&e.jsxs(a,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[e.jsx(a,{children:"Preview"}),!t.enableMultiRange&&e.jsxs(a,{display:"flex",gap:"spacing-xxs",alignItems:"center",children:[e.jsx(a,{children:t.rangelowerlimit}),e.jsx(a,{width:"100%",children:e.jsx(ve,{val:s,min:Number(t.rangelowerlimit),max:Number(t.rangeupperlimit),step:Number(t.sliderStepValue),defaultVal:Number(t.defaultValue),onChange:({x:o})=>{d(o)},preview:!0})}),e.jsx(a,{children:t.rangeupperlimit})]}),t.enableMultiRange&&e.jsxs(a,{display:"flex",gap:"spacing-xxs",alignItems:"center",backgroundColor:"surface-secondary",padding:"spacing-xs",borderRadius:"radius-xxs",children:[e.jsx(a,{children:t.rangelowerlimit}),e.jsx(a,{width:"100%",children:e.jsx(Ne,{startVal:p,endVal:R,min:Number(t.rangelowerlimit),max:Number(t.rangeupperlimit),step:Number(t.sliderStepValue),defaultStartVal:Number(t.multirangelowerlimit),defaultEndVal:Number(t.multirangeupperlimit),onChange:({startVal:o,endVal:m})=>{_(o),S(m)},preview:!0})}),e.jsx(a,{children:t.rangeupperlimit})]})]})]})},ie=({modalControl:t})=>{const{values:i,handleSubmit:r,handleChange:n,touched:l,errors:u,setFieldValue:s}=T(),{onClose:d}=t;return e.jsx(a,{width:"100%",children:e.jsx("form",{onSubmit:r,children:e.jsxs(a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",gap:"spacing-md",children:[e.jsx(b,{textAlign:"center",variant:"h4-semibold",children:"Add a Setting"}),e.jsxs(a,{display:"flex",flexDirection:"column",gap:"spacing-md",padding:"spacing-xxs spacing-xs",width:"-webkit-fill-available",maxHeight:{initial:"440px",ml:"340px"},css:_e`overflow-y:scroll;`,customScrollbar:!0,children:[e.jsx(N,{placeholder:"e.g. Announcements",label:"Setting Name",totalCount:50,value:i.settingName,onChange:n("settingName"),error:l.settingName&&!!u.settingName,errorMessage:l.settingName?u.settingName:""}),e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(b,{ellipsis:!0,variant:"h6-bold",children:"Set as Default"}),e.jsx(b,{variant:"bes-regular",children:"Setting on for users by default"})]}),e.jsx(de,{leadingToggle:!1,checked:i.isDefault,onCheckedChange:p=>s("isDefault",p)})]}),e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(b,{ellipsis:!0,variant:"h6-bold",children:"Range"}),e.jsx(b,{variant:"bes-regular",children:"Set a range for this setting e.g. 1-10"})]}),e.jsx(de,{leadingToggle:!1,checked:i.enableRange,onCheckedChange:p=>s("enableRange",p)})]}),i.enableRange&&e.jsx(te,{})]}),e.jsxs(a,{display:"flex",justifyContent:"center",alignItems:"center",padding:"spacing-xxs",gap:"spacing-xs",alignSelf:"center",children:[e.jsx(M,{size:"small",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(M,{size:"small",variant:"primary",children:"Save settings"})]})]})})})},ne=({modalControl:t,settingsToEdit:i,handleSettingsChange:r})=>{const{isOpen:n,onClose:l}=t,u=s=>{const d=i.index!==0?i.index:Math.floor(Math.random()*1e6),p=s.enableRange?s.enableMultiRange?{type:3,default:{lower:Number(s.multirangelowerlimit),upper:Number(s.multirangeupperlimit)},enabled:s.isDefault,description:s.settingName,lowerLimit:Number(s.rangelowerlimit),upperLimit:Number(s.rangeupperlimit),ticker:Number(s.sliderStepValue),index:d}:{type:2,default:Number(s.defaultValue),enabled:s.isDefault,description:s.settingName,lowerLimit:Number(s.rangelowerlimit),upperLimit:Number(s.rangeupperlimit),ticker:Number(s.sliderStepValue),index:d}:{type:1,default:s.isDefault,description:s.settingName,index:d};r(p),l()};return e.jsx(Ve,{isOpen:n,onClose:l,acceptButtonProps:null,cancelButtonProps:null,children:e.jsx(ee,{initialValue:i,onSubmit:s=>{u(s)},children:e.jsx(ie,{modalControl:t})})})},re=({modalControl:t,channelSettings:i,loadingSettings:r,settingsToEdit:n,setSettingsToEdit:l})=>{const{isWalletConnected:u,connect:s}=I(),[d,p]=f.useState([]),{open:_}=t;f.useEffect(()=>{i&&!r&&p(i)},[r]);const R=m=>{p(j=>j.filter(w=>w.index!==m.index))},S=m=>{const j=d.findIndex(w=>w.index===m.index);if(j===-1)p([...d,m]);else{const w=d.map((V,y)=>y===j?{...m}:V);p(w)}},o=()=>u?_():s();return e.jsxs(a,{width:"100%",display:"flex",flexDirection:"column",gap:"spacing-md",children:[d.length>0?e.jsx(G,{newSettings:d,modalControl:t,setSettingsToEdit:l,loadingSettings:r,handleDeleteSetting:R,handleSettingsChange:S}):e.jsx(Pe,{state:"notificationSettings",title:"No settings yet",subTitle:"Add options for users to customize notifications.",onClick:o}),e.jsx(ne,{modalControl:t,settingsToEdit:n,setNewSettings:p,handleSettingsChange:S}),e.jsx(Y,{newSettings:d,channelSettings:i})]})},ae=()=>{const{account:t}=I(),i=K(),r=ue(),[n,l]=f.useState(P),{data:u,isLoading:s}=Me(t),d=(u==null?void 0:u.channel_settings)??"",p=s?Array(3).fill(0):d?JSON.parse(d):[];return f.useEffect(()=>{!u&&!s&&r(`${H.Channels}`)},[u]),e.jsxs(a,{display:"flex",padding:{initial:"spacing-lg",ml:"spacing-md"},flexDirection:"column",gap:"spacing-md",width:{ml:"357px",initial:"800px"},alignItems:"center",borderRadius:"radius-md",backgroundColor:"surface-primary",children:[e.jsx(W,{modalControl:i,setSettingsToEdit:l}),e.jsx(re,{modalControl:i,settingsToEdit:n,setSettingsToEdit:l,channelSettings:p,loadingSettings:s})]})},ce=()=>e.jsx(Re,{children:e.jsx(ae,{})})});export{Qe as __tla,ce as default};
