import{e1 as t,er as ee,d_ as h,hF as pe,dY as M,e2 as r,eq as x,eY as _,g9 as me,hG as te,hH as he,hI as xe,hJ as ie,hK as fe,dZ as ne,e$ as be,hL as we,d$ as je,hl as Se,e0 as P,ek as Ce,en as ye,h0 as y,fG as ve,fH as Ne,ep as _e,g$ as le,hM as Ve,gB as re,__tla as Re}from"./index-B4LgzV0l.js";import{C as Me,__tla as ke}from"./ContentLayout-CXV_6zqb.js";import{A as Ee,O as De,__tla as Le}from"./OptOut-1bIah08t.js";import{C as Te,__tla as Pe}from"./ChannelDashboardNullState-C8fYIS9Y.js";import{u as Ie,S as Ae,__tla as qe}from"./StakingVariant-cw9H_2yJ.js";import{u as Fe,__tla as He}from"./useMutation-CWyDy2bw.js";import{a as $e,__tla as Oe}from"./PushTokenContractHelper-Bk4qyzY6.js";import{C as ze,__tla as Be}from"./Checkbox-DZuAd3-3.js";import{c as Ke,a as Ue,d as I,e as c,f as ae,u as Ze,F as We,b as Je,__tla as Ye}from"./index.esm-DapUXXNE.js";import{g as v,a as V}from"./Common.form-UgI-u8l5.js";let se,Ge=Promise.all([(()=>{try{return Re}catch{}})(),(()=>{try{return ke}catch{}})(),(()=>{try{return Le}catch{}})(),(()=>{try{return Pe}catch{}})(),(()=>{try{return qe}catch{}})(),(()=>{try{return He}catch{}})(),(()=>{try{return Oe}catch{}})(),(()=>{try{return Be}catch{}})(),(()=>{try{return Ye}catch{}})()]).then(async()=>{let A,q,F,H,$,E,O,z,B,k,K,U,Z,W,D,J,Y,G,Q,X;A=e=>{const{svgProps:i,...n}=e;return t.jsx(ee,{componentName:"KebabMenuVertical",icon:t.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i,children:[t.jsxs("g",{"clip-path":"url(#clip0_372_37265)",children:[t.jsx("path",{d:"M16 9.00001C17.3807 9.00001 18.5 7.88072 18.5 6.5C18.5 5.11929 17.3807 4 16 4C14.6193 4 13.5 5.11929 13.5 6.5C13.5 7.88072 14.6193 9.00001 16 9.00001Z",fill:"currentColor"}),t.jsx("path",{d:"M16 18.5C17.3807 18.5 18.5 17.3807 18.5 16C18.5 14.6193 17.3807 13.5 16 13.5C14.6193 13.5 13.5 14.6193 13.5 16C13.5 17.3807 14.6193 18.5 16 18.5Z",fill:"currentColor"}),t.jsx("path",{d:"M16 28C17.3807 28 18.5 26.8807 18.5 25.5C18.5 24.1193 17.3807 23 16 23C14.6193 23 13.5 24.1193 13.5 25.5C13.5 26.8807 14.6193 28 16 28Z",fill:"currentColor"})]}),t.jsx("defs",{children:t.jsx("clipPath",{id:"clip0_372_37265",children:t.jsx("rect",{width:"32",height:"32",fill:"white"})})})]}),...n})},q=e=>{const{svgProps:i,...n}=e;return t.jsx(ee,{componentName:"Pencil",icon:t.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...i,children:[t.jsx("path",{d:"M8.47489 20.25H4.46739C4.27712 20.25 4.09465 20.1744 3.96012 20.0399C3.82558 19.9053 3.75 19.7229 3.75 19.5326V15.5251C3.75009 15.3351 3.82555 15.1529 3.95984 15.0185L15.0183 3.95995C15.1529 3.82552 15.3353 3.75 15.5254 3.75C15.7156 3.75 15.898 3.82552 16.0325 3.95995L20.04 7.96476C20.1745 8.09928 20.25 8.28168 20.25 8.47186C20.25 8.66204 20.1745 8.84444 20.04 8.97896L8.98154 20.0402C8.84711 20.1744 8.66489 20.2499 8.47489 20.25Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),t.jsx("path",{d:"M12.3589 6.61963L17.3806 11.6413",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})]}),...n})},F=()=>{const[e,i]=h.useState(!1),n=h.useCallback(()=>i(!0),[]),l=h.useCallback(()=>i(!1),[]);return{isOpen:e,onClose:l,open:n}},H=async({userPushSDKInstance:e,settings:i})=>await e.channel.setting(i),$=()=>Fe({mutationKey:[pe],mutationFn:H}),E={type:1,default:0,description:"",index:0},O=({modalControl:e,setSettingsToEdit:i})=>{const{open:n}=e,{isWalletConnected:l,connect:a}=M(),g=()=>{l?n():a()};return t.jsxs(r,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",width:"100%",children:[t.jsxs(r,{children:[t.jsx(x,{variant:"h4-semibold",color:"text-primary",children:"Notification Settings"}),t.jsx(x,{variant:"bs-regular",color:"text-tertiary",children:"Add, Edit or Remove Notification Settings"})]}),t.jsx(_,{size:"extraSmall",variant:"tertiary",leadingIcon:t.jsx(Ee,{}),onClick:()=>{i(E),g()},children:"Add Setting"})]})},z=({setting:e,modalControl:i,loadingSettings:n,setSettingsToEdit:l,handleDeleteSetting:a})=>{const{open:g}=i;return t.jsxs(r,{display:"flex",width:"100%",padding:"spacing-sm spacing-none",justifyContent:"space-between",children:[t.jsx(me,{isLoading:n,height:"20px",width:"100px",children:t.jsxs(r,{display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%",gap:"spacing-xxs",children:[t.jsx(x,{variant:"bs-regular",color:"text-primary",children:e.description}),e.type==2&&t.jsx(te,{children:"Range"}),e.type==3&&t.jsx(te,{children:"Multi-Range"})]})}),t.jsx(he,{overlay:t.jsxs(xe,{children:[t.jsx(ie,{label:"Edit",icon:t.jsx(q,{size:24}),onClick:()=>{l(e),g()}}),t.jsx(ie,{label:"Remove",icon:t.jsx(De,{size:24}),onClick:()=>{a(e)}})]}),children:t.jsx(r,{cursor:"pointer",children:t.jsx(A,{})})})]})},B=({newSettings:e,loadingSettings:i,modalControl:n,setSettingsToEdit:l,handleDeleteSetting:a,handleSettingsChange:g})=>t.jsx(r,{width:"100%",display:"flex",flexDirection:"column",children:e.map((s,u)=>t.jsxs(r,{children:[t.jsx(z,{loadingSettings:i,setting:s,modalControl:n,setSettingsToEdit:l,handleDeleteSetting:a,handleSettingsChange:g}),t.jsx(fe,{})]},u))}),k=50,K=({newSettings:e,channelSettings:i})=>{const n=ne(),{account:l,provider:a,wallet:g,isWalletConnected:s,connect:u}=M(),{userPushSDKInstance:m}=be(p=>p.user),{handleConnectWalletAndEnableProfile:N}=we(),{refetchChannelDetails:R}=je(),[S,d]=h.useState(0),[f,b]=h.useState(""),j=async()=>{const p=await $e({address:l,provider:a,contractAddress:Ce.epnscore});d(parseInt(p))};h.useEffect(()=>{!l||!a||j()},[l,a]);const{mutate:oe,isPending:L}=Ie(),ue=async()=>{if(!a)return;if(!s){u();return}b("");const p=a.getSigner(l),C=ye((k-S).toString(),18);oe({noOfTokenToApprove:C,signer:p},{onSuccess:()=>{j()},onError:o=>{console.log("Error in Approving PUSH",o),o.code=="ACTION_REJECTED"?b("User rejected signature. Please try again."):b("Error in approving PUSH Tokens")}})},{mutate:de,isPending:T}=$(),ge=async()=>{let p=m;if(!(!p.signer&&(p=await N({wallet:g}),!p))&&(b(""),e.length>0)){const C=e.map(o=>o.type===1?{type:o.type,description:o.description,default:o.default?1:0}:{type:o.type,description:o.description,default:o.default,data:{lower:o.lowerLimit,upper:o.upperLimit,ticker:o.ticker,enabled:o.enabled}});de({userPushSDKInstance:p,settings:C},{onSuccess:o=>{console.log("onSuccess >>>",o),o.transactionHash&&(console.log("Call channel details refetch and navigate to dashboard page"),R(),n(`${P.ChannelDashboard}/${l}`))},onError:o=>{console.log("Error in adding setting",o),b("Error in saving settings. Please try again later")}})}},ce=h.useMemo(()=>{if(!i)return!1;if(e.length!==i.length)return!0;let p=!0;for(let C=0;C<e.length;C++){const o=e[C],w=i[C];o.type===1?p=p&&o.type===w.type&&o.description===w.description&&o.default===w.default:o.type===2&&(p=p&&o.type===w.type&&o.description===w.description&&o.default===w.default&&o.enabled===w.enabled&&o.lowerLimit===w.lowerLimit&&o.upperLimit===w.upperLimit&&o.ticker===w.ticker)}return p===!1},[e,i]);return t.jsxs(r,{width:"100%",gap:"spacing-md",display:"flex",flexDirection:"column",children:[f&&t.jsx(Se,{heading:f,variant:"error"}),t.jsx(Ae,{title:"Modify Setting Fee",description:"Make sure all settings are ready before proceeding to the next step",fees:k}),t.jsxs(r,{display:"flex",justifyContent:{initial:"end",ml:"center"},gap:"spacing-xs",children:[t.jsx(_,{variant:"outline",onClick:()=>n(`${P.ChannelDashboard}/${l}`),children:"Cancel"}),S>=k?t.jsx(_,{onClick:ge,disabled:T||!ce,loading:T,children:T?"Saving":"Save Settings"}):t.jsx(_,{onClick:ue,disabled:L,loading:L,children:L?"Approving":"Approve PUSH"})]})]})},U=e=>({settingName:e.description,isDefault:e.type===1?typeof e.default=="boolean"?e.default:!0:e.enabled,enableRange:e.type!==1,rangelowerlimit:e.lowerLimit?e.lowerLimit:0,rangeupperlimit:e.upperLimit?e.upperLimit:0,enableMultiRange:e.type===3,defaultValue:typeof e.default=="number"?e.default:0,multirangelowerlimit:typeof e.default=="object"?e.default.lower:0,multirangeupperlimit:typeof e.default=="object"?e.default.upper:0,sliderStepValue:e.ticker?e.ticker:0}),Z=Ke().shape({settingName:Ue().required(v("Setting Name")),isDefault:I(),enableRange:I(),rangelowerlimit:c().when("enableRange",{is:!0,then:()=>c().min(1,V(1)).required(v("Range")),otherwise:()=>c()}),rangeupperlimit:c().when("enableRange",{is:!0,then:()=>c().min(ae("rangelowerlimit"),V("lower limit")).required(v("Range")),otherwise:()=>c()}),enableMultiRange:I().required("This field is required"),multirangelowerlimit:c().when("enableMultiRange",{is:!0,then:()=>c().min(1,V(1)).required(v("Range")).test("is-multi-range-within-range","Multi-range lower limit must be between lower limit and upper limit",function(e){const{rangelowerlimit:i,rangeupperlimit:n}=this.parent;return e>i&&e<n}),otherwise:()=>c()}),multirangeupperlimit:c().when("enableMultiRange",{is:!0,then:()=>c().min(ae("multirangelowerlimit"),V("lower limit")).required(v("Range")).test("is-multi-range-upper-within-range","Multi-range upper limit must be between lower limit and upper limit",function(e){const{rangelowerlimit:i,rangeupperlimit:n}=this.parent;return e>i&&e<n}),otherwise:()=>c()}),defaultValue:c().when("enableMultiRange",{is:!1,then:()=>c().min(0,V(0)).required(v("Default Value")).test("is-within-range","Default value must be between lower limit and upper limit",function(e){const{rangelowerlimit:i,rangeupperlimit:n}=this.parent;return e>=i&&e<=n}),otherwise:()=>c()}),sliderStepValue:c().when("enableRange",{is:!0,then:()=>c().min(1,V(1)).required(v("Slider Step")).test("is-step-value-valid","Slider step value must not be greater than upper limit",function(e){const{rangeupperlimit:i}=this.parent;return e<i}),otherwise:()=>c()})}),W=({children:e,initialValue:i,onSubmit:n})=>{const l=Ze({initialValues:U(i),validationSchema:Z,onSubmit:n});return t.jsx(We,{value:l,children:e})},D=()=>{const e=Je();if(!e)throw new Error("useEditNotificationSettingsForm must be used within a EditNotificationSettingsFormProvider");return e},J=()=>{const{values:e,handleChange:i,setFieldValue:n,errors:l,touched:a}=D(),g=h.useMemo(()=>e.rangelowerlimit>0&&e.rangeupperlimit>0&&(e.enableMultiRange?e.multirangelowerlimit>0&&e.multirangeupperlimit>0:e.defaultValue>0)&&e.sliderStepValue>0&&Number(e.rangelowerlimit)<=Number(e.rangeupperlimit)&&Number(e.sliderStepValue)>0&&Number(e.sliderStepValue)<=Number(e.rangeupperlimit)-Number(e.rangelowerlimit)&&(e.enableMultiRange?Number(e.multirangelowerlimit)>=Number(e.rangelowerlimit)&&Number(e.multirangeupperlimit)<=Number(e.rangeupperlimit)&&Number(e.multirangeupperlimit)>Number(e.multirangelowerlimit):Number(e.defaultValue)>=Number(e.rangelowerlimit)&&Number(e.defaultValue)<=Number(e.rangeupperlimit)),[e.rangelowerlimit,e.rangeupperlimit,e.defaultValue,e.sliderStepValue,e.multirangelowerlimit,e.multirangeupperlimit,e.enableMultiRange]),[s,u]=h.useState(e.defaultValue),[m,N]=h.useState(e.multirangelowerlimit),[R,S]=h.useState(e.multirangeupperlimit);return t.jsxs(t.Fragment,{children:[t.jsxs(r,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[t.jsx(x,{variant:"h6-bold",children:"Range Values"}),t.jsxs(r,{display:"flex",gap:"spacing-xxs",width:"100%",alignItems:"baseline",children:[t.jsx(y,{placeholder:"e.g.0",type:"number",value:e.rangelowerlimit,onChange:i("rangelowerlimit"),error:a.rangelowerlimit&&!!l.rangelowerlimit,errorMessage:a.rangelowerlimit?l.rangelowerlimit:""}),t.jsx(x,{variant:"bm-regular",children:"to"}),t.jsx(y,{placeholder:"e.g.10",type:"number",value:e.rangeupperlimit,onChange:d=>{n("rangeupperlimit",d.target.value)},error:a.rangeupperlimit&&!!l.rangeupperlimit,errorMessage:a.rangeupperlimit?l.rangeupperlimit:""})]})]}),t.jsxs(r,{display:"flex",gap:"spacing-xxs",children:[t.jsx(ze,{checked:e.enableMultiRange,onChange:()=>n("enableMultiRange",!e.enableMultiRange)}),t.jsxs(r,{children:[t.jsx(x,{ellipsis:!0,variant:"h6-bold",children:"Enable Multi Range"}),t.jsx(x,{variant:"bes-regular",children:"User can select a range of values in the slider"})]})]}),!e.enableMultiRange&&t.jsx(y,{placeholder:"e.g.0",type:"number",value:e.defaultValue,onChange:d=>{u(Number(d.target.value)),n("defaultValue",d.target.value)},label:"Default Value",error:a.defaultValue&&!!l.defaultValue,errorMessage:a.defaultValue?l.defaultValue:""}),e.enableMultiRange&&t.jsxs(r,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[t.jsx(x,{variant:"h6-bold",children:"Range Values"}),t.jsxs(r,{display:"flex",gap:"spacing-xxs",width:"100%",alignItems:"baseline",children:[t.jsx(y,{placeholder:"e.g.0",type:"number",value:e.multirangelowerlimit,onChange:d=>{n("multirangelowerlimit",d.target.value),N(Number(d.target.value))},error:a.multirangelowerlimit&&!!l.multirangelowerlimit,errorMessage:a.multirangelowerlimit?l.multirangelowerlimit:""}),t.jsx(x,{variant:"bm-regular",children:"to"}),t.jsx(y,{placeholder:"e.g.10",type:"number",value:e.multirangeupperlimit,onChange:d=>{n("multirangeupperlimit",d.target.value),S(Number(d.target.value))},error:a.multirangeupperlimit&&!!l.multirangeupperlimit,errorMessage:a.multirangeupperlimit?l.multirangeupperlimit:""})]})]}),t.jsx(r,{children:t.jsx(y,{placeholder:"e.g.0",type:"number",value:e.sliderStepValue,onChange:d=>{i("sliderStepValue"),n("sliderStepValue",d.target.value)},label:"Slider Step Value",error:a.sliderStepValue&&!!l.sliderStepValue,errorMessage:a.sliderStepValue?l.sliderStepValue:""})}),g&&t.jsxs(r,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[t.jsx(r,{children:"Preview"}),!e.enableMultiRange&&t.jsxs(r,{display:"flex",gap:"spacing-xxs",alignItems:"center",children:[t.jsx(r,{children:e.rangelowerlimit}),t.jsx(r,{width:"100%",children:t.jsx(ve,{val:s,min:Number(e.rangelowerlimit),max:Number(e.rangeupperlimit),step:Number(e.sliderStepValue),defaultVal:Number(e.defaultValue),onChange:({x:d})=>{u(d)},preview:!0})}),t.jsx(r,{children:e.rangeupperlimit})]}),e.enableMultiRange&&t.jsxs(r,{display:"flex",gap:"spacing-xxs",alignItems:"center",backgroundColor:"surface-secondary",padding:"spacing-xs",borderRadius:"radius-xxs",children:[t.jsx(r,{children:e.rangelowerlimit}),t.jsx(r,{width:"100%",children:t.jsx(Ne,{startVal:m,endVal:R,min:Number(e.rangelowerlimit),max:Number(e.rangeupperlimit),step:Number(e.sliderStepValue),defaultStartVal:Number(e.multirangelowerlimit),defaultEndVal:Number(e.multirangeupperlimit),onChange:({startVal:d,endVal:f})=>{N(d),S(f)},preview:!0})}),t.jsx(r,{children:e.rangeupperlimit})]})]})]})},Y=({modalControl:e})=>{const{values:i,handleSubmit:n,handleChange:l,touched:a,errors:g,setFieldValue:s}=D(),{onClose:u}=e;return t.jsx(r,{width:"100%",children:t.jsx("form",{onSubmit:n,children:t.jsxs(r,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",gap:"spacing-md",children:[t.jsx(x,{textAlign:"center",variant:"h4-semibold",children:"Add a Setting"}),t.jsxs(r,{display:"flex",flexDirection:"column",gap:"spacing-md",padding:"spacing-xxs spacing-xs",width:"-webkit-fill-available",maxHeight:"440px",css:_e`overflow-y:scroll;`,customScrollbar:!0,children:[t.jsx(y,{placeholder:"e.g. Announcements",label:"Setting Name",totalCount:50,value:i.settingName,onChange:l("settingName"),error:a.settingName&&!!g.settingName,errorMessage:a.settingName?g.settingName:""}),t.jsxs(r,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(r,{children:[t.jsx(x,{ellipsis:!0,variant:"h6-bold",children:"Set as Default"}),t.jsx(x,{variant:"bes-regular",children:"Setting on for users by default"})]}),t.jsx(le,{leadingToggle:!1,checked:i.isDefault,onCheckedChange:m=>s("isDefault",m)})]}),t.jsxs(r,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[t.jsxs(r,{children:[t.jsx(x,{ellipsis:!0,variant:"h6-bold",children:"Range"}),t.jsx(x,{variant:"bes-regular",children:"Set a range for this setting e.g. 1-10"})]}),t.jsx(le,{leadingToggle:!1,checked:i.enableRange,onCheckedChange:m=>s("enableRange",m)})]}),i.enableRange&&t.jsx(J,{})]}),t.jsxs(r,{display:"flex",justifyContent:"center",alignItems:"center",padding:"spacing-xxs",gap:"spacing-xs",alignSelf:"center",children:[t.jsx(_,{size:"small",variant:"outline",onClick:u,children:"Cancel"}),t.jsx(_,{size:"small",variant:"primary",children:"Save settings"})]})]})})})},G=({modalControl:e,settingsToEdit:i,handleSettingsChange:n})=>{const{isOpen:l,onClose:a}=e,g=s=>{const u=i.index!==0?i.index:Math.floor(Math.random()*1e6),m=s.enableRange?s.enableMultiRange?{type:3,default:{lower:Number(s.multirangelowerlimit),upper:Number(s.multirangeupperlimit)},enabled:s.isDefault,description:s.settingName,lowerLimit:Number(s.rangelowerlimit),upperLimit:Number(s.rangeupperlimit),ticker:Number(s.sliderStepValue),index:u}:{type:2,default:Number(s.defaultValue),enabled:s.isDefault,description:s.settingName,lowerLimit:Number(s.rangelowerlimit),upperLimit:Number(s.rangeupperlimit),ticker:Number(s.sliderStepValue),index:u}:{type:1,default:s.isDefault,description:s.settingName,index:u};n(m),a()};return t.jsx(Ve,{isOpen:l,onClose:a,acceptButtonProps:null,cancelButtonProps:null,children:t.jsx(W,{initialValue:i,onSubmit:s=>{g(s)},children:t.jsx(Y,{modalControl:e})})})},Q=({modalControl:e,channelSettings:i,loadingSettings:n,settingsToEdit:l,setSettingsToEdit:a})=>{const{isWalletConnected:g,connect:s}=M(),[u,m]=h.useState([]),{open:N}=e;h.useEffect(()=>{i&&!n&&m(i)},[n]);const R=f=>{m(b=>b.filter(j=>j.index!==f.index))},S=f=>{const b=u.findIndex(j=>j.index===f.index);if(b===-1)m([...u,f]);else{const j=[...u];j[b]=f,m(j)}},d=()=>{g?N():s()};return t.jsxs(r,{width:"100%",display:"flex",flexDirection:"column",gap:"spacing-md",children:[u.length>0?t.jsx(B,{newSettings:u,modalControl:e,setSettingsToEdit:a,loadingSettings:n,handleDeleteSetting:R,handleSettingsChange:S}):t.jsx(Te,{state:"notificationSettings",title:"No settings yet",subTitle:"Add options for users to customize notifications.",onClick:d}),t.jsx(G,{modalControl:e,settingsToEdit:l,setNewSettings:m,handleSettingsChange:S}),t.jsx(K,{newSettings:u,channelSettings:i})]})},X=()=>{const{account:e}=M(),{data:i,isLoading:n}=re(e),l=i!=null&&i.channel_settings?i==null?void 0:i.channel_settings:"",a=n?Array(3).fill(0):l?JSON.parse(l):[],g=F(),[s,u]=h.useState(E);return t.jsxs(r,{display:"flex",padding:{initial:"spacing-lg",ml:"spacing-md"},flexDirection:"column",gap:"spacing-md",width:{ml:"357px",initial:"800px"},alignItems:"center",borderRadius:"radius-md",backgroundColor:"surface-primary",children:[t.jsx(O,{modalControl:g,setSettingsToEdit:u}),t.jsx(Q,{modalControl:g,settingsToEdit:s,setSettingsToEdit:u,channelSettings:a,loadingSettings:n})]})},se=()=>{const{account:e}=M(),i=ne(),{data:n,isLoading:l}=re(e);return h.useEffect(()=>{!l&&!n&&i(`${P.Channels}`)},[n,l]),t.jsx(Me,{children:t.jsx(X,{})})}});export{Ge as __tla,se as default};
