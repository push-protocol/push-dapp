import{e1 as e,er as oe,d_ as m,i3 as fe,dY as P,e2 as l,eq as b,eY as T,g9 as be,i4 as ue,i5 as je,i6 as we,i7 as de,i8 as Se,dZ as ge,e$ as Ce,i9 as ye,d$ as ve,hC as Ne,e0 as H,ek as _e,en as Ve,hh as _,fG as Re,fH as ke,ep as Me,hg as ce,ia as De,gT as Ee,__tla as Le}from"./index-DVdq7mRC.js";import{C as Pe,__tla as Te}from"./ContentLayout-BDmcI_18.js";import{C as Ie,__tla as Ae}from"./ChannelDashboardNullState-Cs7KZxdc.js";import{A as Fe,O as Oe,__tla as qe}from"./OptOut-Br8yRusr.js";import{u as He,S as $e,__tla as Be}from"./StakingVariant-DpSOzN28.js";import{u as ze,__tla as Ue}from"./useMutation-DwKmha6d.js";import{g as Ke,a as We,__tla as Ze}from"./PushTokenContractHelper-CQLpaULU.js";import{c as Je,a as Ye,d as $,e as g,f as pe,u as Ge,F as Qe,b as Xe,__tla as et}from"./index.esm-B3hwMEpp.js";import{g as v,a as R,b as B}from"./Common.form-iMV6nXze.js";import{C as tt,__tla as it}from"./Checkbox-C1fGe8LF.js";let me,nt=Promise.all([(()=>{try{return Le}catch{}})(),(()=>{try{return Te}catch{}})(),(()=>{try{return Ae}catch{}})(),(()=>{try{return qe}catch{}})(),(()=>{try{return Be}catch{}})(),(()=>{try{return Ue}catch{}})(),(()=>{try{return Ze}catch{}})(),(()=>{try{return et}catch{}})(),(()=>{try{return it}catch{}})()]).then(async()=>{let z,U,K,W,Z,I,J,Y,G,D,Q,X,ee,te,E,ie,ne,ae,re,le,se;z=t=>{const{svgProps:n,...a}=t;return e.jsx(oe,{componentName:"KebabMenuVertical",icon:e.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[e.jsxs("g",{"clip-path":"url(#clip0_372_37265)",children:[e.jsx("path",{d:"M16 9.00001C17.3807 9.00001 18.5 7.88072 18.5 6.5C18.5 5.11929 17.3807 4 16 4C14.6193 4 13.5 5.11929 13.5 6.5C13.5 7.88072 14.6193 9.00001 16 9.00001Z",fill:"currentColor"}),e.jsx("path",{d:"M16 18.5C17.3807 18.5 18.5 17.3807 18.5 16C18.5 14.6193 17.3807 13.5 16 13.5C14.6193 13.5 13.5 14.6193 13.5 16C13.5 17.3807 14.6193 18.5 16 18.5Z",fill:"currentColor"}),e.jsx("path",{d:"M16 28C17.3807 28 18.5 26.8807 18.5 25.5C18.5 24.1193 17.3807 23 16 23C14.6193 23 13.5 24.1193 13.5 25.5C13.5 26.8807 14.6193 28 16 28Z",fill:"currentColor"})]}),e.jsx("defs",{children:e.jsx("clipPath",{id:"clip0_372_37265",children:e.jsx("rect",{width:"32",height:"32",fill:"white"})})})]}),...a})},U=t=>{const{svgProps:n,...a}=t;return e.jsx(oe,{componentName:"Pencil",icon:e.jsxs("svg",{width:"inherit",height:"inherit",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n,children:[e.jsx("path",{d:"M8.47489 20.25H4.46739C4.27712 20.25 4.09465 20.1744 3.96012 20.0399C3.82558 19.9053 3.75 19.7229 3.75 19.5326V15.5251C3.75009 15.3351 3.82555 15.1529 3.95984 15.0185L15.0183 3.95995C15.1529 3.82552 15.3353 3.75 15.5254 3.75C15.7156 3.75 15.898 3.82552 16.0325 3.95995L20.04 7.96476C20.1745 8.09928 20.25 8.28168 20.25 8.47186C20.25 8.66204 20.1745 8.84444 20.04 8.97896L8.98154 20.0402C8.84711 20.1744 8.66489 20.2499 8.47489 20.25Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e.jsx("path",{d:"M12.3589 6.61963L17.3806 11.6413",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})]}),...a})},K=()=>{const[t,n]=m.useState(!1),a=m.useCallback(()=>n(!0),[]),i=m.useCallback(()=>n(!1),[]);return{isOpen:t,onClose:i,open:a}},W=async({userPushSDKInstance:t,settings:n})=>await t.channel.setting(n),Z=()=>ze({mutationKey:[fe],mutationFn:W}),I={type:1,default:0,description:"",index:0},J=({modalControl:t,setSettingsToEdit:n})=>{const{open:a}=t,{isWalletConnected:i,connect:r}=P(),u=()=>i?a():r();return e.jsxs(l,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",width:"100%",children:[e.jsxs(l,{children:[e.jsx(b,{variant:"h4-semibold",color:"text-primary",children:"Notification Settings"}),e.jsx(b,{variant:"bs-regular",color:"text-tertiary",children:"Add, Edit or Remove Notification Settings"})]}),e.jsx(T,{size:"extraSmall",variant:"tertiary",leadingIcon:e.jsx(Fe,{}),onClick:()=>{n(I),u()},children:"Add Setting"})]})},Y=({setting:t,modalControl:n,loadingSettings:a,setSettingsToEdit:i,handleDeleteSetting:r})=>{const{open:u}=n;return e.jsxs(l,{display:"flex",width:"100%",padding:"spacing-sm spacing-none",justifyContent:"space-between",children:[e.jsx(be,{isLoading:a,height:"20px",width:"100px",children:e.jsxs(l,{display:"flex",justifyContent:"space-between",alignItems:"center",height:"100%",gap:"spacing-xxs",children:[e.jsx(b,{variant:"bs-regular",color:"text-primary",children:t.description}),t.type==2&&e.jsx(ue,{children:"Range"}),t.type==3&&e.jsx(ue,{children:"Multi-Range"})]})}),e.jsx(je,{overlay:e.jsxs(we,{children:[e.jsx(de,{label:"Edit",icon:e.jsx(U,{size:24}),onClick:()=>{i(t),u()}}),e.jsx(de,{label:"Remove",icon:e.jsx(Oe,{size:24}),onClick:()=>{r(t)}})]}),children:e.jsx(l,{cursor:"pointer",children:e.jsx(z,{})})})]})},G=({newSettings:t,loadingSettings:n,modalControl:a,setSettingsToEdit:i,handleDeleteSetting:r,handleSettingsChange:u})=>e.jsx(l,{width:"100%",display:"flex",flexDirection:"column",children:t.map((j,h)=>e.jsxs(l,{children:[e.jsx(Y,{loadingSettings:n,setting:j,modalControl:a,setSettingsToEdit:i,handleDeleteSetting:r,handleSettingsChange:u}),e.jsx(Se,{})]},h))}),D=50,Q=({newSettings:t,channelSettings:n})=>{const a=ge(),{account:i,provider:r,wallet:u,isWalletConnected:j,connect:h}=P(),{userPushSDKInstance:S}=Ce(c=>c.user),{handleConnectWalletAndEnableProfile:y}=ye(),{refetchChannelDetails:o}=ve(),[w,s]=m.useState(0),[p,f]=m.useState(""),[V,N]=m.useState(0),L=async()=>{const c=await Ke({address:i,provider:r});N(c)},k=async()=>{const c=await We({address:i,provider:r,contractAddress:_e.epnscore});s(parseInt(c))};m.useEffect(()=>{!i||!r||(k(),L())},[i,r]);const{mutate:A,isPending:M}=He(),F=async()=>{if(!r)return;if(!j){h();return}f("");const c=r.getSigner(i),x=Ve((D-w).toString(),18);A({noOfTokenToApprove:x,signer:c},{onSuccess:()=>{k()},onError:d=>{console.log("Error in Approving PUSH",d),d.code=="ACTION_REJECTED"?f("User rejected signature. Please try again."):f("Error in approving PUSH Tokens")}})},{mutate:O,isPending:q}=Z(),he=async()=>{let c=S;if(!(!c.signer&&(c=await y({wallet:u}),!c))&&(f(""),t.length)){const x=t.map(d=>d.type===1?{type:d.type,description:d.description,default:d.default?1:0}:{type:d.type,description:d.description,default:d.default,data:{lower:d.lowerLimit,upper:d.upperLimit,ticker:d.ticker,enabled:d.enabled}});O({userPushSDKInstance:c,settings:x},{onSuccess:d=>{d.transactionHash&&(o(),a(`${H.ChannelDashboard}/${i}`))},onError:d=>{console.log("Error in adding setting",d),f("Error in saving settings. Please try again later")}})}},xe=m.useMemo(()=>{if(!n)return!1;if(t.length!==n.length)return!0;let c=!1;return t.forEach((x,d)=>{const C=n[d];if(x.type!==C.type){c=!0;return}if(x.type===1&&(x.description!==C.description||x.default!==C.default)){c=!0;return}if(x.type===2&&(x.description!==C.description||x.default!==C.default||x.enabled!==C.enabled||x.lowerLimit!==C.lowerLimit||x.upperLimit!==C.upperLimit||x.ticker!==C.ticker)){c=!0;return}}),c},[t,n]);return e.jsxs(l,{width:"100%",gap:"spacing-md",display:"flex",flexDirection:"column",children:[p&&e.jsx(Ne,{heading:p,variant:"error"}),e.jsx($e,{title:"Modify Setting Fee",description:"Make sure all settings are ready before proceeding to the next step",fees:D,pushApprovalAmount:w,showBalance:!0,balance:V,setBalance:N}),e.jsxs(l,{display:"flex",justifyContent:{initial:"end",ml:"center"},gap:"spacing-xs",children:[e.jsx(T,{variant:"outline",onClick:()=>a(`${H.ChannelDashboard}/${i}`),children:"Cancel"}),w>=D?e.jsx(T,{onClick:he,disabled:q||!xe,loading:q,children:q?"Saving":"Save Settings"}):e.jsx(T,{onClick:F,disabled:M,loading:M,children:M?"Approving":"Approve PUSH"})]})]})},X=t=>({settingName:t.description,isDefault:t.type===1?typeof t.default=="boolean"?t.default:!0:t.enabled,enableRange:t.type!==1,rangelowerlimit:t.lowerLimit?t.lowerLimit:0,rangeupperlimit:t.upperLimit?t.upperLimit:0,enableMultiRange:t.type===3,defaultValue:typeof t.default=="number"?t.default:0,multirangelowerlimit:typeof t.default=="object"?t.default.lower:0,multirangeupperlimit:typeof t.default=="object"?t.default.upper:0,sliderStepValue:t.ticker?t.ticker:0}),ee=Je().shape({settingName:Ye().required(v("Setting Name")),isDefault:$(),enableRange:$(),rangelowerlimit:g().when("enableRange",{is:!0,then:()=>g().min(1,R(1)).required(v("Range")),otherwise:()=>g()}),rangeupperlimit:g().when("enableRange",{is:!0,then:()=>g().min(pe("rangelowerlimit"),R("Lower limit")).required(v("Range")),otherwise:()=>g()}),enableMultiRange:$().required(v("")),multirangelowerlimit:g().when("enableMultiRange",{is:!0,then:()=>g().min(1,R(1)).required(v("Range")).test("is-multi-range-within-range",B("Multi-range lower limit"),(t,n)=>{const{rangelowerlimit:a,rangeupperlimit:i}=n.parent;return t>=a&&t<i}),otherwise:()=>g()}),multirangeupperlimit:g().when("enableMultiRange",{is:!0,then:()=>g().min(pe("multirangelowerlimit"),R("Lower limit")).required(v("Range")).test("is-multi-range-upper-within-range",B("Multi-range upper limit"),(t,n)=>{const{rangelowerlimit:a,rangeupperlimit:i}=n.parent;return t>a&&t<=i}),otherwise:()=>g()}),defaultValue:g().when(["enableMultiRange","enableRange"],{is:(t,n)=>!t&&n,then:()=>g().min(0,R(0)).required(v("Default Value")).test("is-within-range",B("Default value"),(t,n)=>{const{rangelowerlimit:a,rangeupperlimit:i}=n.parent;return console.log("context",n.parent,t),t>=a&&t<=i}),otherwise:()=>g()}),sliderStepValue:g().when("enableRange",{is:!0,then:()=>g().min(1,R(1)).required(v("Slider Step")).test("is-step-value-valid","Slider step value must not exceed the range limits.",(t,n)=>{const{rangeupperlimit:a}=n.parent;return t<a}),otherwise:()=>g()})}),te=({children:t,initialValue:n,onSubmit:a})=>{const i=X(n),r=Ge({initialValues:i,enableReinitialize:!0,validationSchema:ee,onSubmit:a});return e.jsx(Qe,{value:r,children:t})},E=()=>{const t=Xe();if(!t)throw new Error("useEditNotificationSettingsForm must be used within a EditNotificationSettingsFormProvider");return t},ie=()=>{const{values:t,handleChange:n,setFieldValue:a,errors:i,touched:r}=E(),u=m.useMemo(()=>{const{rangelowerlimit:s,rangeupperlimit:p,enableMultiRange:f,multirangelowerlimit:V,multirangeupperlimit:N,defaultValue:L,sliderStepValue:k}=t,A=Number(s)>0&&Number(p)>0,M=Number(k)>0&&Number(k)<=Number(p)-Number(s),F=!f&&Number(L)>=Number(s)&&Number(L)<=Number(p),O=f&&Number(V)>=Number(s)&&Number(N)<=Number(p)&&Number(N)>Number(V);return A&&M&&(O||F)},[t]),[j,h]=m.useState(t.defaultValue),[S,y]=m.useState(t.multirangelowerlimit),[o,w]=m.useState(t.multirangeupperlimit);return e.jsxs(e.Fragment,{children:[e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[e.jsx(b,{variant:"h6-bold",children:"Range Values"}),e.jsxs(l,{display:"flex",gap:"spacing-xxs",width:"100%",alignItems:"baseline",children:[e.jsx(_,{placeholder:"e.g.0",type:"number",value:t.rangelowerlimit,onChange:n("rangelowerlimit"),error:r.rangelowerlimit&&!!i.rangelowerlimit,errorMessage:r.rangelowerlimit?i.rangelowerlimit:""}),e.jsx(b,{variant:"bm-regular",children:"to"}),e.jsx(_,{placeholder:"e.g.10",type:"number",value:t.rangeupperlimit,onChange:s=>{a("rangeupperlimit",s.target.value)},error:r.rangeupperlimit&&!!i.rangeupperlimit,errorMessage:r.rangeupperlimit?i.rangeupperlimit:""})]})]}),e.jsxs(l,{display:"flex",gap:"spacing-xxs",children:[e.jsx(tt,{checked:t.enableMultiRange,onChange:()=>a("enableMultiRange",!t.enableMultiRange)}),e.jsxs(l,{children:[e.jsx(b,{ellipsis:!0,variant:"h6-bold",children:"Enable Multi Range"}),e.jsx(b,{variant:"bes-regular",children:"User can select a range of values in the slider"})]})]}),!t.enableMultiRange&&e.jsx(_,{placeholder:"e.g.0",type:"number",value:t.defaultValue,onChange:s=>{h(Number(s.target.value)),a("defaultValue",s.target.value)},label:"Default Value",error:r.defaultValue&&!!i.defaultValue,errorMessage:r.defaultValue?i.defaultValue:""}),t.enableMultiRange&&e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[e.jsx(b,{variant:"h6-bold",children:"Range Values"}),e.jsxs(l,{display:"flex",gap:"spacing-xxs",width:"100%",alignItems:"baseline",children:[e.jsx(_,{placeholder:"e.g.0",type:"number",value:t.multirangelowerlimit,onChange:s=>{a("multirangelowerlimit",s.target.value),y(Number(s.target.value))},error:r.multirangelowerlimit&&!!i.multirangelowerlimit,errorMessage:r.multirangelowerlimit?i.multirangelowerlimit:""}),e.jsx(b,{variant:"bm-regular",children:"to"}),e.jsx(_,{placeholder:"e.g.10",type:"number",value:t.multirangeupperlimit,onChange:s=>{a("multirangeupperlimit",s.target.value),w(Number(s.target.value))},error:r.multirangeupperlimit&&!!i.multirangeupperlimit,errorMessage:r.multirangeupperlimit?i.multirangeupperlimit:""})]})]}),e.jsx(l,{children:e.jsx(_,{placeholder:"e.g.0",type:"number",value:t.sliderStepValue,onChange:n("sliderStepValue"),label:"Slider Step Value",error:r.sliderStepValue&&!!i.sliderStepValue,errorMessage:r.sliderStepValue?i.sliderStepValue:""})}),u&&e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-xxs",children:[e.jsx(l,{children:"Preview"}),!t.enableMultiRange&&e.jsxs(l,{display:"flex",gap:"spacing-xxs",alignItems:"center",children:[e.jsx(l,{children:t.rangelowerlimit}),e.jsx(l,{width:"100%",children:e.jsx(Re,{val:j,min:Number(t.rangelowerlimit),max:Number(t.rangeupperlimit),step:Number(t.sliderStepValue),defaultVal:Number(t.defaultValue),onChange:({x:s})=>{h(s)},preview:!0})}),e.jsx(l,{children:t.rangeupperlimit})]}),t.enableMultiRange&&e.jsxs(l,{display:"flex",gap:"spacing-xxs",alignItems:"center",backgroundColor:"surface-secondary",padding:"spacing-xs",borderRadius:"radius-xxs",children:[e.jsx(l,{children:t.rangelowerlimit}),e.jsx(l,{width:"100%",children:e.jsx(ke,{startVal:S,endVal:o,min:Number(t.rangelowerlimit),max:Number(t.rangeupperlimit),step:Number(t.sliderStepValue),defaultStartVal:Number(t.multirangelowerlimit),defaultEndVal:Number(t.multirangeupperlimit),onChange:({startVal:s,endVal:p})=>{y(s),w(p)},preview:!0})}),e.jsx(l,{children:t.rangeupperlimit})]})]})]})},ne=()=>{const{values:t,handleChange:n,touched:a,errors:i,setFieldValue:r}=E();return e.jsx(l,{width:"100%",children:e.jsx("form",{onSubmit:()=>{},children:e.jsxs(l,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",gap:"spacing-md",children:[e.jsx(b,{textAlign:"center",variant:"h4-semibold",children:"Add a Setting"}),e.jsxs(l,{display:"flex",flexDirection:"column",gap:"spacing-md",padding:"spacing-xxs spacing-xs",width:"-webkit-fill-available",maxHeight:{initial:"85vh",ml:"45vh"},css:Me`
              overflow-y: scroll;
            `,customScrollbar:!0,children:[e.jsx(_,{placeholder:"e.g. Announcements",label:"Setting Name",totalCount:50,value:t.settingName,onChange:n("settingName"),error:a.settingName&&!!i.settingName,errorMessage:a.settingName?i.settingName:""}),e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{children:[e.jsx(b,{ellipsis:!0,variant:"h6-bold",children:"Set as Default"}),e.jsx(b,{variant:"bes-regular",children:"Setting on for users by default"})]}),e.jsx(ce,{leadingToggle:!1,checked:t.isDefault,onCheckedChange:u=>r("isDefault",u)})]}),e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{children:[e.jsx(b,{ellipsis:!0,variant:"h6-bold",children:"Range"}),e.jsx(b,{variant:"bes-regular",children:"Set a range for this setting e.g. 1-10"})]}),e.jsx(ce,{leadingToggle:!1,checked:t.enableRange,onCheckedChange:u=>r("enableRange",u)})]}),t.enableRange&&e.jsx(ie,{})]})]})})})},ae=({isOpen:t,onClose:n,settingsToEdit:a,handleSettingsChange:i})=>{const{values:r,validateForm:u,setTouched:j,dirty:h,resetForm:S}=E(),y=async o=>{if(j({settingName:!0,defaultValue:!0,rangelowerlimit:!0,rangeupperlimit:!0,multirangelowerlimit:!0,multirangeupperlimit:!0,sliderStepValue:!0,enableRange:!0,enableMultiRange:!0,isDefault:!0}),h){const p=await u();if(Object.keys(p).length>0)return}const w=a.index!==0?a.index:Math.floor(Math.random()*1e6),s=o.enableRange?o.enableMultiRange?{type:3,default:{lower:Number(o.multirangelowerlimit),upper:Number(o.multirangeupperlimit)},enabled:o.isDefault,description:o.settingName,lowerLimit:Number(o.rangelowerlimit),upperLimit:Number(o.rangeupperlimit),ticker:Number(o.sliderStepValue),index:w}:{type:2,default:Number(o.defaultValue),enabled:o.isDefault,description:o.settingName,lowerLimit:Number(o.rangelowerlimit),upperLimit:Number(o.rangeupperlimit),ticker:Number(o.sliderStepValue),index:w}:{type:1,default:o.isDefault,description:o.settingName,index:w};i(s),S(),n()};return e.jsx(De,{isOpen:t,onClose:n,acceptButtonProps:{children:"Save Settings",onClick:()=>{y(r)}},cancelButtonProps:{children:"Cancel"},children:e.jsx(ne,{onClose:n})})},re=({modalControl:t,settingsToEdit:n,handleSettingsChange:a})=>{const{isOpen:i,onClose:r}=t;return e.jsx(te,{initialValue:n,onSubmit:u=>{},children:e.jsx(ae,{isOpen:i,onClose:r,settingsToEdit:n,handleSettingsChange:a})})},le=({modalControl:t,channelSettings:n,loadingSettings:a})=>{const{isWalletConnected:i,connect:r}=P(),[u,j]=m.useState(I),[h,S]=m.useState([]);m.useEffect(()=>{n&&!a&&S(n)},[a]);const y=s=>{S(p=>p.filter(f=>f.index!==s.index))},o=s=>{const p=h.findIndex(f=>f.index===s.index);if(p===-1)S([...h,s]);else{const f=h.map((V,N)=>N===p?{...s}:V);S(f)}},w=()=>i?open():r();return e.jsxs(e.Fragment,{children:[e.jsx(J,{modalControl:t,setSettingsToEdit:j}),h.length>0?e.jsx(G,{newSettings:h,modalControl:t,setSettingsToEdit:j,loadingSettings:a,handleDeleteSetting:y,handleSettingsChange:o}):e.jsx(Ie,{state:"notificationSettings",title:"No settings yet",subTitle:"Add options for users to customize notifications.",onClick:w}),e.jsx(re,{modalControl:t,settingsToEdit:u,setNewSettings:S,handleSettingsChange:o}),e.jsx(Q,{newSettings:h,channelSettings:n})]})},se=()=>{const{account:t}=P(),n=K(),a=ge(),{data:i,isLoading:r}=Ee(t),u=(i==null?void 0:i.channel_settings)??"",j=r?Array(3).fill(0):u?JSON.parse(u):[];return m.useEffect(()=>{!i&&!r&&a(`${H.Channels}`)},[i]),e.jsx(l,{display:"flex",padding:{initial:"spacing-lg",ml:"spacing-md"},flexDirection:"column",gap:"spacing-md",width:{ml:"357px",initial:"800px"},alignItems:"center",borderRadius:"radius-md",backgroundColor:"surface-primary",children:e.jsx(le,{modalControl:n,channelSettings:j,loadingSettings:r})})},me=()=>e.jsx(Pe,{children:e.jsx(se,{})})});export{nt as __tla,me as default};
